<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Persistent Storage Example</title>
    <!-- Other head elements like meta, title, CSS, etc. -->
     <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>
     <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
     <script src="https://apis.google.com/js/api.js"></script>
     <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
 <script src="https://js.pusher.com/beams/1.0/push-notifications-cdn.js"></script>
<script>
    // Initialize Pusher Beams
    const beamsClient = new PusherPushNotifications.Client({
      instanceId: 'dd857255-a776-4693-b811-b2caf5ef52b7',
    });

    // Start Pusher Beams
    beamsClient.start()
      .then(() => {
        console.log('Pusher Beams initialized and client started.');
      })
      .catch(console.error);
</script>
     <script src="loadattendeailfromfirestore.js"></script> 

    
  <!-- Define the checkList script in the head section -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const savedValuesList = document.getElementById('savedValuesList');
            const storedEmail = localStorage.getItem('loggedInEmail');
            const createinvit = document.getElementById('createinvit');
            const endtime = document.getElementById('endtime');
            const starttime = document.getElementById('starttime');
            const meetingdesc = document.getElementById('meetingdesc');
            const repeatevery = document.getElementById('repeatevery');
            const repeatfrequency = document.getElementById('repeatFrequency');
            const numofoccur = document.getElementById('numofoccur');
            console.log('enabledisable', storedEmail);
            console.log('length', savedValuesList.children.length);

        
            // Function to check the list and enable/disable the button
            function checkList() {
                let shouldEnableButton = false;

                // Iterate through each child and compare with storedEmail
                for (let i = 0; i < savedValuesList.children.length; i++) {
                    const listItem = savedValuesList.children[i];
                    const childValue = listItem.textContent.trim();

                    if (childValue === storedEmail) {
                        console.log('Match found:', childValue, storedEmail);
                        shouldEnableButton = true;
                    } else {
                        console.log('No Match found:', childValue, storedEmail);
                    }
                }

                // Enable or disable the button based on the comparison
                createinvit.disabled = !shouldEnableButton;
                starttime.disabled = !shouldEnableButton;
                endtime.disabled = !shouldEnableButton;
                meetingdesc.disabled = !shouldEnableButton;
                repeatevery.disabled = !shouldEnableButton;
                repeatfrequency.disabled = !shouldEnableButton;
                numofoccur.disabled = !shouldEnableButton;
                console.log('test:', shouldEnableButton, storedEmail);
            }

            // Attach the event listener to trigger the checkList function
            document.getElementById('meetingdesc').addEventListener('click', function() {
                checkList();
            });
        });
    </script>
    
    
</head>
<body>
   <h4 style="font-weight:bold;color:#0000ff;">Enter:Google Meet list of attendees emails with the</h4>
     <h4 style="font-weight:bold;color:#0000ff;font-style:Times New Roman">logged email in blue bold font (REQUIRED)</h4>
    <input type="email" id="attendeeEmail" name="attendeeEmail" placeholder="Enter attendee's email here.." style="height: 30px; width: 300px; background-color: #ddfcf7" required>
    <button id="sendinvit" style="height: 35px;">Add attendees</button>   
    <script src="sendinvtoattendee.js"></script> 

       <button id="signout" style="height: 35px;">Sign out</button>
     <script>
    document.getElementById('signout').addEventListener('click', function() {
       window.top.location.href = 'loginscreen.html';
    });
  </script>
     
<div id="container" style="display: flex; align-items: flex-start; margin-top: 15px;">
    <div>
        <h3 style="margin-bottom: 2px;">Attendee Emails</h3>
        <ul id="savedValuesList" style="margin: 0; padding: 25px; list-style-type: none; position: relative;"></ul>
    </div>
    <button id="deleteattendee1" style="margin-left: 27px; height: 35px;">Delete Attendee</button>
</div>

<script>
    // Handle selection
    document.getElementById('savedValuesList').addEventListener('click', function(event) {
        if (event.target && event.target.nodeName === 'LI') {
            // Remove 'selected' class from all list items
            Array.from(this.children).forEach(item => item.classList.remove('selected'));
            // Add 'selected' class to the clicked list item
            event.target.classList.add('selected');
        }
    });

    // Handle deletion
    document.getElementById('deleteattendee1').addEventListener('click', function() {
        const selectedItem = document.querySelector('#savedValuesList li.selected');
        if (selectedItem) {
            selectedItem.remove();
        }
    });
</script>

<style>
    /* Style for selected item */
    #savedValuesList li.selected {
        background-color: #b3d9ff;
        color: #333;
        width: 100%;
        padding: 10px;
        box-sizing: border-box;
    }
</style>

    
     <div style="display: flex; justify-content: flex-end; padding: 20px;">
        <h4 
            id="texttip" 
            style=" 
                background-color: #ffffdd;
                font-style: Times New Roman;
                text-align: center;
                font-weight: bold; /* Make font bold */
                position: fixed; /* Fixed position */
                right: 20px; /* Distance from the right edge */
                top: 35px; /* Distance from the top edge */
                display: flex;
                margin: 0; /* Remove default margin */
                /* Additional inline styles here if needed */
            "
        >
           Enter: (Attendees emails-Start time-End time
           <br>and meeting description) for creating 
            <br>new meeting...
        </h4>
    </div>
    
    <div style="display: flex; justify-content: flex-end; padding: 20px;" id="checkListTrigger">
        <input 
            id="meetingdesc" 
            name="meetingdesc" 
            placeholder="Enter the Meeting desc here.." 
            style="
                height: 30px; 
                width: 300px; 
                background-color: #ddfcf7; 
                text-align: center;
                font-weight: bold; /* Make font bold */
                position: fixed; /* Absolute position within .container */
                right: 20px; /* Distance from the right edge */
                top: 100px;
                /* Additional inline styles here if needed */
            " 
            required
            >
    </div>
    
<div style="display: flex; justify-content: flex-end; padding: 20px;" id="checkListTrigger1">
        <input 
            type="datetime-local" 
            id="starttime" 
            name="starttime" 
            placeholder="Enter the start time here.." 
            style="
                height: 30px; 
                width: 300px; 
                background-color: #ddfcf7; 
                text-align: center;
                font-weight: bold; /* Make font bold */
                 position: fixed; /* Absolute position within .container */
                 right: 20px; /* Distance from the right edge */
                  top: 140px;
                /* Additional inline styles here if needed */
            " 
            required
        >
    </div>
     <script>
        // Add event listener to trigger the checkList function on click
        document.getElementById('checkListTrigger').addEventListener('click', function() {
            checkList();
        });
    </script>
      <script>
        // Add event listener to trigger the checkList function on click
        document.getElementById('checkListTrigger1').addEventListener('click', function() {
            checkList();
        });
    </script>
    
     <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script>
        flatpickr("#starttime", {
            enableTime: true,
            dateFormat: "Y-m-d H:i", // Customize date format
            placeholder: "Enter date and time"
        });
    </script>
    <div style="display: flex; justify-content: flex-end; padding: 20px;">
        <input 
            type="datetime-local" 
            id="endtime" 
            name="endtime" 
            placeholder="Enter the end time here.." 
            style="
                height: 30px; 
                width: 300px; 
                background-color: #ddfcf7; 
                text-align: center;
                font-weight: bold; /* Make font bold */
               position: fixed; /* Absolute position within .container */
               right: 20px; /* Distance from the right edge */
               top: 180px;
                /* Additional inline styles here if needed */
            " 
            required
        >
    </div>
     <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script>
        flatpickr("#endtime", {
            enableTime: true,
            dateFormat: "Y-m-d H:i", // Customize date format
            placeholder: "Enter date and time"
        });
    </script>
    <div style="display: flex; justify-content: flex-end; padding: 20px;">
          <span style="
        font-weight: bold;
        margin-right: 10px; /* Adjust the spacing between the title and input fields */
        position: fixed; 
        right: 210px; 
        top: 225px;
    ">Repeat Every:</span>
        <input 
            id="repeatevery" 
            name="repeatevery"  
            style="
                height: 30px; 
                width: 60px; 
                background-color: #ddfcf7; 
                text-align: center;
                font-weight: bold; /* Make font bold */
                position: fixed; /* Absolute position within .container */
                right: 135px; /* Distance from the right edge */
                top: 220px;
                /* Additional inline styles here if needed */
            " 
        >
         <select 
        id="repeatFrequency" 
        name="repeatFrequency"
        style="
            height: 35px; 
            width: 100px; 
            background-color: #ddfcf7; 
            text-align: center;
            font-weight: bold; 
            position: fixed; 
            right: 20px; 
            top: 220px;
        "
    >
        <option value="null"></option>
        <option value="Daily">Daily</option>
        <option value="Weekly">Weekly</option>
        <option value="Monthly">Monthly</option>
        <option value="Yearly">Yearly</option>
    </select>
     <div style="display: flex; justify-content: flex-end; padding: 20px;">
         <span style="
        font-weight: bold;
        margin-right: 10px; /* Adjust the spacing between the title and input fields */
        position: fixed; 
        right: 210px; 
        top: 265px;
    ">No of Occurs:</span>
        <input 
            id="numofoccur" 
            name="numofoccur"  
            style="
                height: 30px; 
                width: 60px; 
                background-color: #ddfcf7; 
                text-align: center;
                font-weight: bold; /* Make font bold */
                position: fixed; /* Absolute position within .container */
                right: 135px; /* Distance from the right edge */
                top: 260px;
                /* Additional inline styles here if needed */
            " 
        >   
    <button id="loadinvit" style="
                height: 35px; 
                text-align: center;
                font-weight: bold; /* Make font bold */
               position: fixed; /* Absolute position within .container */
               right: 35px; /* Distance from the right edge */
               top: 305px;
                /* Additional inline styles here if needed */
            " 
        >Load invit</button>

     <script>
document.addEventListener('DOMContentLoaded', function() {
    const loadInvitButton = document.getElementById('loadinvit');
    
    loadInvitButton.addEventListener('click', function() {
        // Retrieve the access token and logged-in email from localStorage
        const accessToken = localStorage.getItem('accessToken');
        const loggedInEmail = localStorage.getItem('loggedInEmail');
        
        if (accessToken && loggedInEmail) {
            // Function to load meetings for the logged-in email
            function loadMeetings() {
                fetch('https://www.googleapis.com/calendar/v3/calendars/primary/events', {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${accessToken}`,
                    }
                })
                .then(response => response.json())
                .then(data => {
                    // Filter events to include only those where the logged-in email is an attendee
                    const filteredEvents = data.items.filter(event => 
                        event.attendees && event.attendees.some(attendee => attendee.email === loggedInEmail)
                    );

                    // Create a new window and display the meeting data
                    const newWindow = window.open('', '_blank', 'toolbar=no,location=no,status=no,menubar=no,scrollbars=yes,resizable=yes');
                    newWindow.document.write('<html><head><title>Meetings</title></head><body>');
                    newWindow.document.write('<h2>Meetings</h2>');
                    newWindow.document.write('<ul>');
                    
                    filteredEvents.forEach(event => {
                        const startTime = new Date(event.start.dateTime).toLocaleString();
                        const endTime = new Date(event.end.dateTime).toLocaleString();
                        const creatorEmail = event.creator.email;
                        const description = event.description || 'No description';
                        const hangoutLink = event.hangoutLink || 'No link available';
                        
                        // Determine if the event is recurring
                        let recurrenceInfo = 'Single event';
                        if (event.recurrence) {
                            recurrenceInfo = 'Recurring event';

                            // Example: Extracting the number of occurrences (if available)
                            const recurrenceRule = event.recurrence[0]; // Recurrence rules like 'RRULE:FREQ=WEEKLY;COUNT=10'
                            const countMatch = recurrenceRule.match(/COUNT=(\d+)/);
                            if (countMatch) {
                                recurrenceInfo += `, Occurs ${countMatch[1]} times`;
                            }

                            // Extract the recurrence frequency (e.g., daily, weekly, monthly)
                            const freqMatch = recurrenceRule.match(/FREQ=(\w+)/);
                            if (freqMatch) {
                                recurrenceInfo += `, Frequency: ${freqMatch[1].toLowerCase()}`;
                            }
                        }

                        newWindow.document.write(`
                            <li>
                                <strong>Start Time:</strong> ${startTime}<br>
                                <strong>End Time:</strong> ${endTime}<br>
                                <strong>Creator's Email:</strong> ${creatorEmail}<br>
                                <strong>Description:</strong> ${description}<br>
                                <strong>Meeting Link:</strong> <a href="${hangoutLink}" target="_blank">${hangoutLink}</a><br>
                                <strong>Meeting Type:</strong> ${recurrenceInfo}
                            </li>
                        `);
                    });

                    newWindow.document.write('</ul>');
                    newWindow.document.write('</body></html>');
                    newWindow.document.close();
                })
                .catch(error => {
                    console.error('Error loading meetings:', error);
                    alert('There was an error loading the meetings.');
                });
            }
            
            loadMeetings();
        } else {
            alert('Access token or logged-in email is missing.');
        }
    });
});
</script>


    
     <button id="updateinvit" style=" height: 35px; 
                text-align: center;
                font-weight: bold; /* Make font bold */
               position: fixed; /* Absolute position within .container */
               right: 120px; /* Distance from the right edge */
               top: 305px;
                /* Additional inline styles here if needed */
            ">Update invit</button>
  <script>
document.getElementById("updateinvit").onclick = function() {
    var accessToken = localStorage.getItem('accessToken');
    var loggedInEmail = localStorage.getItem('loggedInEmail');
    var meetings = [];
    var currentIndex = 0;

    function loadMeetings() {
        if (accessToken && loggedInEmail) {
            fetch('https://www.googleapis.com/calendar/v3/calendars/primary/events', {
                method: 'GET',
                headers: {
                    'Authorization': `Bearer ${accessToken}`,
                }
            })
            .then(response => response.json())
            .then(data => {
                meetings = data.items.filter(event => 
                    event.creator.email === loggedInEmail
                );
                if (meetings.length === 0) {
                    alert('No meetings found');
                } else {
                    showMeeting(meetings[currentIndex]);
                }
            })
            .catch(error => {
                console.error('Error fetching meetings:', error);
                alert('Failed to load meetings');
            });
        } else {
            alert('Missing access token or logged-in email');
        }
    }

    function parseRecurrenceRule(recurrence) {
        if (!recurrence || !recurrence[0].startsWith('RRULE:')) return {};

        const rule = recurrence[0].replace('RRULE:', '').split(';');
        const result = {};

        rule.forEach(part => {
            const [key, value] = part.split('=');
            if (key === 'FREQ') {
                result.frequency = value.toLowerCase();
            } else if (key === 'INTERVAL') {
                result.interval = parseInt(value, 10);
            } else if (key === 'COUNT') {
                result.count = parseInt(value, 10);
            }
        });

        return result;
    }

    function showMeeting(meeting) {
        if (!meeting) {
            alert('No meeting data available');
            return;
        }

        var updateWindow = window.open("", "Update Meetings", "width=800,height=600");

        updateWindow.document.body.innerHTML = '';

        const recurrenceDetails = parseRecurrenceRule(meeting.recurrence);

        updateWindow.document.write('<title>Update Meeting Details</title>');
        updateWindow.document.write('<h2>Update Meetings</h2>');
        updateWindow.document.write(`
            <style>
                .attendee-item {
                    cursor: pointer;
                }
                .attendee-item.selected {
                    background-color: #b3d9ff;
                }
            </style>
            <p><strong>Description:</strong> <input type="text" id="description" style="width: 500px; height: 80px;" value="${meeting.description || ''}"></p>
            <p><strong>Start Time:</strong> <input type="datetime-local" id="startTime" value="${meeting.start.dateTime ? new Date(meeting.start.dateTime).toISOString().slice(0, 16) : ''}"></p>
            <p><strong>End Time:</strong> <input type="datetime-local" id="endTime" value="${meeting.end.dateTime ? new Date(meeting.end.dateTime).toISOString().slice(0, 16) : ''}"></p>
            <p><strong>Repeat Every:</strong> <input type="number" id="repeatevery" value="${recurrenceDetails.interval || ''}" style="width: 60px;"></p>
            <p><strong>Repeat Frequency:</strong>
                <select id="repeatFrequency">
                    <option value="null"></option>
                    <option value="daily" ${recurrenceDetails.frequency === 'daily' ? 'selected' : ''}>Daily</option>
                    <option value="weekly" ${recurrenceDetails.frequency === 'weekly' ? 'selected' : ''}>Weekly</option>
                    <option value="monthly" ${recurrenceDetails.frequency === 'monthly' ? 'selected' : ''}>Monthly</option>
                    <option value="yearly" ${recurrenceDetails.frequency === 'yearly' ? 'selected' : ''}>Yearly</option>
                </select>
            </p>
            <p><strong>Number of Occurrences:</strong> <input type="number" id="numofoccur" value="${recurrenceDetails.count || ''}" style="width: 60px;"></p>
            <ul id="attendeesList"></ul>
            <input type="text" id="attendeeEmail" placeholder="Add Attendee">
            <button id="addAttendee">Add Attendee</button>
            <button id="deleteAttendee">Delete Attendee</button>
            <button id="previous">Previous</button><button id="next">Next</button>
            <button id="updateMeeting">Update Meeting</button><button id="deleteMeeting">Delete Meeting</button>
        `);

        var attendeesList = updateWindow.document.getElementById('attendeesList');
        var addAttendeeInput = updateWindow.document.getElementById('attendeeEmail');
        var addAttendeeButton = updateWindow.document.getElementById('addAttendee');
        var deleteAttendeeButton = updateWindow.document.getElementById('deleteAttendee');

        attendeesList.innerHTML = '';
        if (meeting.attendees) {
            meeting.attendees.forEach(function(attendee) {
                var li = updateWindow.document.createElement('li');
                li.className = 'attendee-item';
                li.textContent = attendee.email;
                attendeesList.appendChild(li);
            });
        }

        addAttendeeButton.onclick = function() {
            var newAttendee = addAttendeeInput.value.trim();
            if (newAttendee && !Array.from(attendeesList.children).some(li => li.textContent === newAttendee)) {
                var li = updateWindow.document.createElement('li');
                li.className = 'attendee-item';
                li.textContent = newAttendee;
                attendeesList.appendChild(li);
                meeting.attendees.push({ email: newAttendee });
            } else {
                updateWindow.alert('Attendee already added or email is empty');
            }
        };

        deleteAttendeeButton.onclick = function() {
            var selectedAttendee = updateWindow.document.querySelector('ul#attendeesList li.selected');
            if (selectedAttendee) {
                meeting.attendees = meeting.attendees.filter(function(att) {
                    return att.email !== selectedAttendee.textContent;
                });
                attendeesList.removeChild(selectedAttendee);
            } else {
                updateWindow.alert('Please select an attendee to delete');
            }
        };

        attendeesList.onclick = function(event) {
            if (event.target && event.target.matches("li.attendee-item")) {
                var selectedItems = updateWindow.document.querySelectorAll('ul#attendeesList li.selected');
                selectedItems.forEach(function(item) {
                    item.classList.remove('selected');
                });
                event.target.classList.add('selected');
            }
        };

        updateWindow.document.getElementById('next').onclick = function() {
            currentIndex = (currentIndex + 1) % meetings.length;
            showMeeting(meetings[currentIndex]);
        };

        updateWindow.document.getElementById('previous').onclick = function() {
            currentIndex = (currentIndex - 1 + meetings.length) % meetings.length;
            showMeeting(meetings[currentIndex]);
        };

       updateWindow.document.getElementById('updateMeeting').onclick = function() {
    var filteredAttendees = meeting.attendees.map(attendee => ({ email: attendee.email }));
    var updatedMeeting = {
        summary: meeting.summary,
        description: updateWindow.document.getElementById('description').value,
        start: { 
            dateTime: new Date(updateWindow.document.getElementById('startTime').value).toISOString(),
            timeZone: "Asia/Baghdad" // Include the Baghdad time zone
        },
        end: { 
            dateTime: new Date(updateWindow.document.getElementById('endTime').value).toISOString(),
            timeZone: "Asia/Baghdad" // Include the Baghdad time zone
        },
        attendees: filteredAttendees
    };

    var repeatEvery = updateWindow.document.getElementById('repeatevery').value;
    var repeatFrequency = updateWindow.document.getElementById('repeatFrequency').value.toUpperCase();
    var numOfOccur = updateWindow.document.getElementById('numofoccur').value;

    if (repeatEvery && repeatFrequency && numOfOccur) {
        updatedMeeting.recurrence = [
            `RRULE:FREQ=${repeatFrequency};INTERVAL=${repeatEvery};COUNT=${numOfOccur}`
        ];
    }

    var xhrUpdate = new XMLHttpRequest();
    xhrUpdate.open('PUT', 'https://www.googleapis.com/calendar/v3/calendars/primary/events/' + meeting.id + '?access_token=' + accessToken);
    xhrUpdate.setRequestHeader('Content-Type', 'application/json');
    xhrUpdate.onload = function() {
        if (xhrUpdate.status === 200) {
            var updatedRecurrence = updatedMeeting.recurrence ? updatedMeeting.recurrence.join(", ") : 'None';
            updateWindow.alert(`Meeting updated:\n${JSON.stringify(updatedMeeting)}\nRecurrence: ${updatedRecurrence}`);
        } else {
            updateWindow.alert('Failed to update meeting');
            console.error('Error:', xhrUpdate.responseText);
        }
    };
    xhrUpdate.send(JSON.stringify(updatedMeeting));
};


        updateWindow.document.getElementById('deleteMeeting').onclick = function() {
            var xhrDelete = new XMLHttpRequest();
            xhrDelete.open('DELETE', 'https://www.googleapis.com/calendar/v3/calendars/primary/events/' + meeting.id + '?access_token=' + accessToken);
            xhrDelete.onload = function() {
                if (xhrDelete.status === 204) {
                    updateWindow.alert('Meeting deleted');
                    currentIndex = (currentIndex + 1) % meetings.length;
                    showMeeting(meetings[currentIndex]);
                } else {
                    updateWindow.alert('Failed to delete meeting');
                }
            };
            xhrDelete.send();
        };
    }

    loadMeetings();
};
     </script>


    
     <button id="createinvit" style=" height: 35px; 
                text-align: center;
                font-weight: bold; /* Make font bold */
               position: fixed; /* Absolute position within .container */
               right: 220px; /* Distance from the right edge */
               top: 305px;
                /* Additional inline styles here if needed */
            " 
         >Create invit</button>
    
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const savedValuesList = document.getElementById('savedValuesList');
        const startTimeInput = document.getElementById('starttime');
        const endTimeInput = document.getElementById('endtime');
        const descInput = document.getElementById('meetingdesc');
        const createInvitButton = document.getElementById('createinvit');
        const repeatEveryInput = document.getElementById('repeatevery');
        const repeatFrequencyInput = document.getElementById('repeatFrequency');
        const numOfOccurInput = document.getElementById('numofoccur');

        function validateInputs() {
            if (startTimeInput.value === '' || endTimeInput.value === '') {
                alert("Please enter both start time and end time.");
                return false;
            }
            return true;
        }

        function generateRequestId() {
            return 'req-' + Date.now() + '-' + Math.floor(Math.random() * 10000);
        }

        const accessToken = localStorage.getItem('accessToken');
        console.log('access token is:', accessToken);

        function createMeetingEvent() {
            if (savedValuesList.children.length > 0 && accessToken) {
                const attendees = Array.from(savedValuesList.children).map(item => ({ email: item.textContent }));
                const startTime = new Date(startTimeInput.value).toISOString();
                const endTime = new Date(endTimeInput.value).toISOString();
                const timeZone = Intl.DateTimeFormat().resolvedOptions().timeZone;

                const event = {
                    summary: 'Meeting Event',
                    description: descInput.value,
                    start: { dateTime: startTime, timeZone: timeZone },
                    end: { dateTime: endTime, timeZone: timeZone },
                    attendees: attendees,
                    conferenceData: {
                        createRequest: {
                            requestId: generateRequestId(),
                            conferenceSolutionKey: {
                                type: "hangoutsMeet"
                            }
                        }
                    }
                };

                // Validate and construct the RRULE
                if (repeatEveryInput.value && repeatFrequencyInput.value && numOfOccurInput.value) {
                    const freq = repeatFrequencyInput.value.toUpperCase(); // Convert to uppercase (e.g., DAILY, WEEKLY)
                    const interval = parseInt(repeatEveryInput.value); // Convert to an integer
                    const count = parseInt(numOfOccurInput.value); // Convert to an integer

                    // Check that all values are valid
                    if (!isNaN(interval) && !isNaN(count) && ['DAILY', 'WEEKLY', 'MONTHLY', 'YEARLY'].includes(freq)) {
                        event.recurrence = [
                            `RRULE:FREQ=${freq};INTERVAL=${interval};COUNT=${count}`
                        ];
                    } else {
                        console.error('Invalid recurrence inputs.');
                        alert('Invalid recurrence inputs.');
                        return;
                    }
                }

                fetch('https://www.googleapis.com/calendar/v3/calendars/primary/events?conferenceDataVersion=1', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${accessToken}`,
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(event),
                })
                .then(response => response.json())
                .then(data => {
                    if (data.error) {
                        console.error('Error creating event:', data.error.message);
                    } else {
                        console.log('Event created:', data);
                        const conferenceId = data.conferenceData.createRequest.conferenceSolutionKey.type;
                        const createdDate = new Date(data.created).toLocaleString();
                        const creatorEmail = data.creator.email;
                        const hangoutLink = data.hangoutLink;
                        const startTime = new Date(data.start.dateTime).toLocaleString();
                        const endTime = new Date(data.end.dateTime).toLocaleString();
                        const recurrence = data.recurrence ? data.recurrence.join(", ") : 'None';
                        const status = data.status;
                        const summary = data.summary;
                        const description = data.description;

                        const alertMessage = `
                            Creation of the meeting event successful, details:
                            Conference ID: ${conferenceId}
                            Created Date: ${createdDate}
                            Creator Email: ${creatorEmail}
                            Hangout Link: ${hangoutLink}
                            Start Time: ${startTime}
                            End Time: ${endTime}
                            Recurrence: ${recurrence}
                            Status: ${status}
                            Summary: ${summary}
                            Description: ${description}
                        `;

                        alert(alertMessage);
                    }
                })
                .catch(error => {
                    console.error('Error creating event:', error);
                    alert('There was an error creating the meeting event.');
                });
            } else {
                console.error('Access token is missing or no attendees available.');
            }
        }

        createInvitButton.addEventListener('click', function() {
            if (validateInputs()) { 
                createMeetingEvent();
            }
        });
    });
</script>    
</body>
</html>
