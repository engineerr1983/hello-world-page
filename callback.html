<!-- callback.html -->

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OAuth Callback</title>

    
   <style>
  /* Styling for the email list container */
  .email-list {
    position: fixed; /* Fixes the position relative to the viewport */
    top: 10px; /* Distance from the top of the viewport */
    right: 70px; /* Distance from the right edge of the viewport */
    background-color: #ddfcf7;
    padding: 10px;
    border: 1px solid #ccc;
    max-width: 300px; /* Limiting the width of the list */
    overflow-y: auto; /* Adding scrollbars if content exceeds max-height */
    max-height: 80vh; /* Limiting the height to 80% of viewport height */
  }

  /* Styling for the list items inside email list */
  .email-list ul {
    list-style-type: none;
    padding: 0;
    margin: 0;
  }

  .email-list ul li {
    margin-bottom: 5px;
  }

  /* Additional styling for the textarea and main content area */
  .main-content {
    margin-top: 50px; /* Ensuring content is below email list */
    margin-left: 10px; /* Margin from the left edge */
  }
</style>

      <script src="https://apis.google.com/js/api.js"></script>

 <script>
    // Client ID and API key from the Developer Console
    const CLIENT_ID = '919212619443-d2ck4cv25sfhvvg5n1rj82ob81h56362.apps.googleusercontent.com';
    const API_KEY = 'AIzaSyB9w-tA4BIQGizvsG2shukDsflojuGvx28';

    // Array of API discovery doc URLs for APIs used by the application
    const DISCOVERY_DOCS = ["https://www.googleapis.com/discovery/v1/apis/gmail/v1/rest"];

    // Authorization scopes required by the API; multiple scopes can be included, separated by spaces.
    const SCOPES = 'https://www.googleapis.com/auth/gmail.readonly';

    let authorizeButton = document.getElementById('authorize-button');
    let signoutButton = document.getElementById('signout-button');

    function handleClientLoad() {
      // Load the API client and auth2 library
      gapi.load('client:auth2', initClient);
    }

    function initClient() {
      gapi.client.init({
        apiKey: API_KEY,
        clientId: CLIENT_ID,
        discoveryDocs: DISCOVERY_DOCS,
        scope: SCOPES
      }).then(function () {
        // Listen for sign-in state changes.
        gapi.auth2.getAuthInstance().isSignedIn.listen(updateSigninStatus);

        // Handle the initial sign-in state.
        updateSigninStatus(gapi.auth2.getAuthInstance().isSignedIn.get());
      });
    }

    function updateSigninStatus(isSignedIn) {
      if (isSignedIn) {
        listLabels();
      }
    }

    function listLabels() {
      gapi.client.gmail.users.messages.list({
        'userId': 'me',
        'labelIds': 'INBOX',
        'maxResults': 10 // Change this number as per your requirement
      }).then(function(response) {
        let messages = response.result.messages;
        if (messages && messages.length > 0) {
          messages.forEach(function(message) {
            // Display message details on your page as needed
            console.log(message);
            // Example: Append subject line to a list
            let subject = message.payload.headers.find(header => header.name === 'Subject').value;
            let listItem = document.createElement('li');
            listItem.textContent = subject;
            document.getElementById('inbox-list').appendChild(listItem);
          });
        } else {
          console.log('No messages found.');
        }
      });
    }
  </script>

    
</head>
<body>
    
     <div class="email-list">
  <p><strong><h2>Valid Contacts:</h2></strong></p>
  <ul id="validEmailList"></ul>
</div>
<script src="validateandlistaddress.js"></script>
    
    
      <script>
        function fetchToken(code) {
            const tokenUrl = 'https://oauth2.googleapis.com/token';
            const clientId = '919212619443-d2ck4cv25sfhvvg5n1rj82ob81h56362.apps.googleusercontent.com'; 
            const clientSecret = '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'; 
            const redirectUri = 'https://engineerr1983.github.io/hello-world-page/callback';

            const requestBody = {
                code: code,
                client_id: clientId,
                client_secret: clientSecret,
                redirect_uri: redirectUri,
                grant_type: 'authorization_code'
            };

            fetch(tokenUrl, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(requestBody)
            })
            .then(response => response.json())
            .then(data => {
                const accessToken = data.access_token;
                console.log('Access token:', accessToken);
                localStorage.setItem('accessToken', accessToken);

                // Optional: Store refresh token if provided
                const refreshToken = data.refresh_token;
                if (refreshToken) {
                    localStorage.setItem('refreshToken', refreshToken);
                }

                // Optionally redirect or perform further actions as needed
            })
            .catch(error => {
                console.error('Error exchanging code for token:', error);
            });
        }

        // Check for OAuth callback and handle it
        if (window.location.pathname === '/hello-world-page/callback') {
            const urlParams = new URLSearchParams(window.location.search);
            const code = urlParams.get('code');
            fetchToken(code); // Function to exchange code for access token
        }
    </script>
      <h1>Send Email</h1>
    <label for="receiverEmail"><h3> Receiver's Email:</h3></label>


    <input type="email" id="receiverEmail" name="receiverEmail" placeholder="Enter Receiver's email here.." required>
     <script src="populatingreceiveremail.js"></script>

    
    <br>
    <label for="messageBody"><h3>Message Body:</h3></label>
    <textarea id="messageBody" name="messageBody" rows="4" cols="40" placeholder="Enter you message here.." required></textarea>
    <br>
    <br>
    <br>
    <button id="sendEmailButton"><h3>Send Email</h3></button>
     <script src="script1.js">
    </script>
 <script src="clearscript.js">
    </script>
     <script>
         document.getElementById('sendEmailButton').addEventListener('click', function() {
              clearFields();
        });
          </script>



</body>
</html>
