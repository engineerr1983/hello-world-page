<!DOCTYPE html>
<html>
<head>
    <title>Cloud Monitoring Client-Side Example</title>
</head>
<body>
    <h1>Storage and Firestore Usage</h1>
    <button id="fetchMetrics">Get Metrics</button>
    <div id="metricsOutput"></div>

    <script>
        document.getElementById('fetchMetrics').addEventListener('click', function() {
            fetchMetrics();
        });

        async function fetchMetrics() {
            const accessToken = localStorage.getItem('accessToken'); // Get the access token from localStorage
            const projectId = 'mystical-surfer-421118'; // Your Google Cloud project ID
            const baseUrl = `https://monitoring.googleapis.com/v3/projects/${projectId}/timeSeries`;

            const queryParams = new URLSearchParams({
                filter: 'metric.type="storage.googleapis.com/total_bytes" OR metric.type="firestore.googleapis.com/document_count"',
                interval: 'startTime="2024-01-01T00:00:00Z",endTime="2024-01-31T23:59:59Z"',  // Adjust for your desired time window
            });

            const url = `${baseUrl}?${queryParams.toString()}`;

            try {
                const response = await fetch(url, {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${accessToken}` // Use the access token for authorization
                    }
                });

                if (!response.ok) {
                    throw new Error('Network response was not OK');
                }

                const data = await response.json();
                console.log(data);

                // Displaying the metrics in your HTML page
                document.getElementById('metricsOutput').innerText = JSON.stringify(data, null, 2);
            } catch (error) {
                console.error('Error fetching metrics:', error);
                document.getElementById('metricsOutput').innerText = 'Failed to fetch metrics';
            }
        }
    </script>
</body>
</html>
