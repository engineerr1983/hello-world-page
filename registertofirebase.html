<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registration</title>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>
</head>
<body>
    <h1>Register</h1>
    <form id="registerForm">
        <input type="email" id="registerEmail" placeholder="Email" style="width:225px; height: 31px;" required>
        <input type="password" id="registerPassword" placeholder="Password" style="width:225px; height: 31px;" required>
        <button type="submit" style="width:75px; height: 35px;">Register</button>
    </form>
    <br>
       <button id="signout" style="width:100px; height: 35px;">Sign out</button>
     <script>
    document.getElementById('signout').addEventListener('click', function() {
       window.top.location.href = 'loginscreen.html';
    });
  </script>
    <br>   
    <br>
      <br>
       <button id="signout" style="width:120px; height: 40px; background-color: #8f26e;">Storage Dashboard</button>
     <script>
    document.getElementById('firebasedash').addEventListener('click', function() {
       window.top.location.href = 'firebasedash.html';
    });
  </script>
    
    
    <script>
        // Your Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBU0ns9VzWBxbHOIgTR-Yb6g1aFbOQEWFA",
            authDomain: "engineerr1983meet.firebaseapp.com",
            projectId: "engineerr1983meet",
            storageBucket: "engineerr1983meet.appspot.com",
            messagingSenderId: "308801516934",
            appId: "1:308801516934:web:1a3833be5e03dfbcd66807",
            measurementId: "G-X22VZ2TVWT"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);

        const auth = firebase.auth();
        const firestore = firebase.firestore();

        // Registration form submission handler
        document.getElementById('registerForm').addEventListener('submit', function (e) {
            e.preventDefault();
            const email = document.getElementById('registerEmail').value;
            const password = document.getElementById('registerPassword').value;

            // Check if the email ends with '@gmail.com'
            if (!email.endsWith('@gmail.com')) {
                alert('Please enter a valid Gmail address ending with "@gmail.com".');
                return;
            }

            // Check if the email is already in the Firestore users_tbl
            firestore.collection('users_tbl').where('email', '==', email)
                .get()
                .then(querySnapshot => {
                    if (!querySnapshot.empty) {
                        alert('This email is already registered.');
                        return;
                    }

                    // Save email and password to Firestore
                    firestore.collection('users_tbl').add({
                        email: email,
                        password: password
                    })
                    .then(() => {
                        console.log('User data saved to Firestore.');
                        alert('Registration successful!');
                    })
                    .catch((error) => {
                        console.error('Error saving user data to Firestore:', error.message);
                        alert('Error saving user data to Firestore: ' + error.message);
                    });
                })
                .catch(error => {
                    console.error('Error checking existing email:', error.message);
                    alert('Error checking existing email: ' + error.message);
                });
        });
    </script>
</body>
</html>
